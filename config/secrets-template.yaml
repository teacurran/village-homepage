# ==============================================================================
# Kubernetes Secrets Template for Village Homepage
# ==============================================================================
#
# This template provides a reference for all secrets required by the application.
# DO NOT commit actual secret values to version control.
#
# For production deployment:
# 1. Copy this file and replace CHANGE_ME placeholders with real values
# 2. Transform into sealed-secrets using the VillageCompute infrastructure tools
# 3. Apply via GitOps pipeline (see ../villagecompute repository)
#
# For local development:
# - Use .env file with values from .env.example
# - Secrets are not required for docker-compose based dev services
#
# Secret Rotation Schedule (see docs/ops/security.md):
# - OAuth credentials: Quarterly + emergency rotation capability
# - Stripe keys: Quarterly + emergency rotation capability
# - External API keys: Quarterly (Alpha Vantage, Meta, LangChain4j)
# - S3/R2 credentials: Quarterly
# - JWT secret: Annually or on suspected compromise
# - Bootstrap token: Single-use, rotates after first superuser creation
# - Encryption keys: Annually or on suspected compromise
#
# ==============================================================================

---
# OAuth Provider Credentials (Google, Facebook, Apple Sign-In)
# Referenced by Quarkus OIDC configuration
# Policy: P1, P9, P14
apiVersion: v1
kind: Secret
metadata:
  name: homepage-oauth-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: authentication
    managed-by: sealed-secrets
type: Opaque
stringData:
  # Google OAuth
  google-client-id: "CHANGE_ME"
  google-client-secret: "CHANGE_ME"

  # Facebook OAuth
  facebook-app-id: "CHANGE_ME"
  facebook-app-secret: "CHANGE_ME"

  # Apple Sign-In
  apple-client-id: "CHANGE_ME"
  apple-team-id: "CHANGE_ME"
  apple-key-id: "CHANGE_ME"
  # Note: Apple private key (.p8 file) should be stored as a separate mounted secret
  # apple-private-key: |
  #   -----BEGIN PRIVATE KEY-----
  #   CHANGE_ME
  #   -----END PRIVATE KEY-----

---
# Stripe Payment Processing Credentials
# Policy: P3, P14
apiVersion: v1
kind: Secret
metadata:
  name: homepage-stripe-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: payments
    managed-by: sealed-secrets
type: Opaque
stringData:
  publishable-key: "pk_live_CHANGE_ME"
  secret-key: "sk_live_CHANGE_ME"
  webhook-secret: "whsec_CHANGE_ME"

---
# External API Credentials (Alpha Vantage, Meta, LangChain4j)
# Policy: P3, P5, P13, P14
apiVersion: v1
kind: Secret
metadata:
  name: homepage-external-api-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: integrations
    managed-by: sealed-secrets
type: Opaque
stringData:
  # Alpha Vantage - Stock market data
  alpha-vantage-api-key: "CHANGE_ME"

  # Meta Graph API - Instagram/Facebook integration
  # Note: Social tokens are encrypted at rest via SECRET_ENCRYPTION_KEY
  meta-app-id: "CHANGE_ME"
  meta-app-secret: "CHANGE_ME"

  # LangChain4j - AI integration (model-agnostic)
  langchain4j-provider: "openai"
  langchain4j-api-key: "CHANGE_ME"
  langchain4j-model-name: "gpt-4o-mini"

---
# S3/Cloudflare R2 Object Storage Credentials
# Policy: P4 - Indefinite screenshot retention with versioning
apiVersion: v1
kind: Secret
metadata:
  name: homepage-s3-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: object-storage
    managed-by: sealed-secrets
type: Opaque
stringData:
  # Cloudflare R2 (S3-compatible) credentials
  s3-endpoint: "https://ACCOUNT_ID.r2.cloudflarestorage.com"
  s3-access-key: "CHANGE_ME"
  s3-secret-key: "CHANGE_ME"
  s3-region: "auto"
  # Bucket names per asset domain (Policy P4)
  s3-bucket-screenshots: "village-homepage-screenshots"
  s3-bucket-listings: "village-homepage-listings"
  s3-bucket-profiles: "village-homepage-profiles"

---
# JWT Signing Secret
# Policy: P9
apiVersion: v1
kind: Secret
metadata:
  name: homepage-jwt-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: authentication
    managed-by: sealed-secrets
type: Opaque
stringData:
  # Generate with: openssl rand -base64 64
  # Rotation invalidates all active sessions
  jwt-secret: "CHANGE_ME_MINIMUM_64_CHARACTERS_BASE64_ENCODED"

---
# Bootstrap Superuser Token (Single-Use)
# Policy: P1
apiVersion: v1
kind: Secret
metadata:
  name: homepage-bootstrap-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: authentication
    managed-by: sealed-secrets
type: Opaque
stringData:
  # Generate with: openssl rand -hex 32
  # Used once for first superuser creation, then rotated
  superuser-token: "CHANGE_ME_MINIMUM_32_CHARACTERS_HEX"

---
# Database Encryption Key (AES-256 for encrypting social tokens, Stripe keys at rest)
# Policy: P3, P5, P13, P14
apiVersion: v1
kind: Secret
metadata:
  name: homepage-encryption-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: encryption
    managed-by: sealed-secrets
type: Opaque
stringData:
  # Generate with: openssl rand -hex 32
  # 256-bit AES key for encrypting sensitive data at rest
  encryption-key: "CHANGE_ME_EXACTLY_64_HEX_CHARACTERS_32_BYTES"

---
# Rate Limiting HMAC Secret
# Policy: P14
apiVersion: v1
kind: Secret
metadata:
  name: homepage-rate-limit-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: rate-limiting
    managed-by: sealed-secrets
type: Opaque
stringData:
  # Generate with: openssl rand -base64 32
  # Used for HMAC signing of rate limit tokens
  hmac-secret: "CHANGE_ME_BASE64_ENCODED"

---
# Optional: HashiCorp Vault Integration
# Uncomment if using Vault for dynamic secret injection
# apiVersion: v1
# kind: Secret
# metadata:
#   name: homepage-vault-credentials
#   namespace: village-homepage
#   labels:
#     app: village-homepage
#     component: vault
#     managed-by: sealed-secrets
# type: Opaque
# stringData:
#   vault-url: "https://vault.villagecompute.com"
#   vault-role: "homepage-app"
#   vault-path: "homepage"

---
# Database Credentials (if not using Vault)
# Note: Prefer managed database service credentials or Vault injection
apiVersion: v1
kind: Secret
metadata:
  name: homepage-database-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: database
    managed-by: sealed-secrets
type: Opaque
stringData:
  postgres-host: "postgres.village-homepage.svc.cluster.local"
  postgres-port: "5432"
  postgres-db: "village_homepage"
  postgres-user: "CHANGE_ME"
  postgres-password: "CHANGE_ME"
  jdbc-url: "jdbc:postgresql://postgres.village-homepage.svc.cluster.local:5432/village_homepage"

---
# Elasticsearch Credentials (if authentication enabled)
apiVersion: v1
kind: Secret
metadata:
  name: homepage-elasticsearch-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: search
    managed-by: sealed-secrets
type: Opaque
stringData:
  elasticsearch-hosts: "elasticsearch.village-homepage.svc.cluster.local:9200"
  elasticsearch-username: "CHANGE_ME"
  elasticsearch-password: "CHANGE_ME"

---
# SMTP Relay Credentials (Production Email)
# Policy: Email relay for marketplace messages, notifications
apiVersion: v1
kind: Secret
metadata:
  name: homepage-smtp-credentials
  namespace: village-homepage
  labels:
    app: village-homepage
    component: email
    managed-by: sealed-secrets
type: Opaque
stringData:
  smtp-host: "smtp.sendgrid.net"
  smtp-port: "587"
  smtp-username: "apikey"
  smtp-password: "CHANGE_ME_SENDGRID_API_KEY"
  smtp-from: "noreply@villagecompute.com"
