[
  {
    "task_id": "I4.T1",
    "iteration_id": "I4",
    "iteration_goal": "Deliver classifieds marketplace foundation covering geo data, categories, listings, payments/promotions, moderation, masked communication, and PostGIS/Elasticsearch search so users can post and discover listings within policy bounds.",
    "description": "Import dr5hn US/Canada geo dataset into `geo_countries`, `geo_states`, `geo_cities`; add PostGIS `location` column, indexes, helper queries, and CLI/script for loading data.\n        Document download + transform steps, integrate with docker-compose for dev.",
    "agent_type_hint": "DatabaseAgent",
    "inputs": "Policy P6, Section F12.1, PostGIS directives.",
    "target_files": [],
    "input_files": [],
    "deliverables": "Migration/loader, script, doc.",
    "acceptance_criteria": "Tables populated, indexes exist, CLI documented, PostGIS queries validated via tests.",
    "dependencies": [
      "I1.T6",
      "I1.T3"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I4.T2",
    "iteration_id": "I4",
    "iteration_goal": "Deliver classifieds marketplace foundation covering geo data, categories, listings, payments/promotions, moderation, masked communication, and PostGIS/Elasticsearch search so users can post and discover listings within policy bounds.",
    "description": "Create `marketplace_categories` schema with hierarchy, seed data per requirements (for sale, housing, jobs, etc.), provide admin CRUD, and caching for frequently accessed category tree.\n        Include moderation metadata (fees, enabled flags).",
    "agent_type_hint": "BackendAgent",
    "inputs": "Feature F12.3, Section 2 components.",
    "target_files": [],
    "input_files": [],
    "deliverables": "Schema, entity, admin endpoints, seeds.",
    "acceptance_criteria": "Category tree accessible, admin can reorder/enable, caching layer hits, tests cover hierarchical queries.",
    "dependencies": [
      "I4.T1"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I4.T3",
    "iteration_id": "I4",
    "iteration_goal": "Deliver classifieds marketplace foundation covering geo data, categories, listings, payments/promotions, moderation, masked communication, and PostGIS/Elasticsearch search so users can post and discover listings within policy bounds.",
    "description": "Implement `marketplace_listings` entity + Panache logic, validation (title, price, description, category, location), default statuses, expiration schedule (30 days) with job `ListingExpirationJobHandler` and reminder job.\n        Provide user endpoints for CRUD and saved drafts.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Feature F12.4–F12.7, Section 2 components, job blueprint.",
    "target_files": [],
    "input_files": [],
    "deliverables": "Schema, service, REST endpoints, jobs, tests.",
    "acceptance_criteria": "Listings persist with statuses, expiration/reminder jobs run, validations enforce limits, API conforms to OpenAPI spec.",
    "dependencies": [
      "I4.T2",
      "I2.T5"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I4.T4",
    "iteration_id": "I4",
    "iteration_goal": "Deliver classifieds marketplace foundation covering geo data, categories, listings, payments/promotions, moderation, masked communication, and PostGIS/Elasticsearch search so users can post and discover listings within policy bounds.",
    "description": "Integrate Stripe Payment Intents for fee categories + promotions; implement `listing_promotions` table, checkout session creation, webhook handlers (success/failure/refund), admin UI for refunds, and policy compliance (P3).\n        Include `payment_refunds` schema + workflow for automatic vs manual refunds.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Policy P3, Feature F12.8, Section 2 components.",
    "target_files": [],
    "input_files": [],
    "deliverables": "Migrations, Stripe client/wrappers, REST endpoints, webhook handler, doc.",
    "acceptance_criteria": "Posting fee enforcement for categories, promotions schedule/resets, refunds logged with statuses, webhook tests pass, doc outlines chargeback process.",
    "dependencies": [
      "I4.T3",
      "I1.T8"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I4.T5",
    "iteration_id": "I4",
    "iteration_goal": "Deliver classifieds marketplace foundation covering geo data, categories, listings, payments/promotions, moderation, masked communication, and PostGIS/Elasticsearch search so users can post and discover listings within policy bounds.",
    "description": "Build marketplace search stack: Elasticsearch indexing for listings, PostGIS radius queries (5–250 miles), filters (category, price, has images, date), sorting options, saved searches, and `/api/marketplace/search` endpoint.\n        Implement pipeline to keep ES index synced with listing CRUD.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Feature F12.2, F12.10, Policy P11, Section 2 components.",
    "target_files": [],
    "input_files": [],
    "deliverables": "Search service, REST resource, job, doc.",
    "acceptance_criteria": "PostGIS + ES queries combined, caching/resilience for ES downtime, filters behave per spec, tests cover radius/performance, doc lists tuning knobs.",
    "dependencies": [
      "I4.T1",
      "I4.T3"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I4.T6",
    "iteration_id": "I4",
    "iteration_goal": "Deliver classifieds marketplace foundation covering geo data, categories, listings, payments/promotions, moderation, masked communication, and PostGIS/Elasticsearch search so users can post and discover listings within policy bounds.",
    "description": "Implement image upload + processing: `marketplace_listing_images` schema, StorageGateway integration, size validation (12 limit), queue-based processing job (resize thumbnail 150x150, list 300x225, full 1200x900), CDN signed URLs, cleanup when listing removed.\n        Update listing composer UI + API for uploads, add tests.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Feature F12.5, StorageGateway from I3, Section 2 components.",
    "target_files": [],
    "input_files": [],
    "deliverables": "Schema, service, job, doc, tests/mocks.",
    "acceptance_criteria": "Upload endpoint returns signed URL, job generates derivatives, metadata stored, cleanup job removes stale images, UI handles progress.",
    "dependencies": [
      "I3.T7",
      "I4.T3"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I4.T7",
    "iteration_id": "I4",
    "iteration_goal": "Deliver classifieds marketplace foundation covering geo data, categories, listings, payments/promotions, moderation, masked communication, and PostGIS/Elasticsearch search so users can post and discover listings within policy bounds.",
    "description": "Build contact system: masked email addresses, message relay endpoints, inbound email processor for replies, spam throttling, logging for compliance, optional phone display.\n        Provide Qute email templates (listing published, inquiry, reply) per F14.3.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Feature F12.6, F14.3, Section 2 components.",
    "target_files": [],
    "input_files": [],
    "deliverables": "Schema, services, jobs, email templates, docs.",
    "acceptance_criteria": "Masked addresses generated, inbound processor routes replies, spam/rate limit enforced, tests simulate IMAP + SMTP flows, docs cover troubleshooting.",
    "dependencies": [
      "I4.T3",
      "I1.T8"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I4.T8",
    "iteration_id": "I4",
    "iteration_goal": "Deliver classifieds marketplace foundation covering geo data, categories, listings, payments/promotions, moderation, masked communication, and PostGIS/Elasticsearch search so users can post and discover listings within policy bounds.",
    "description": "Implement moderation + flagging + fraud detection: `listing_flags` schema, admin queue UI, AI heuristics integrating AiTaggingBudgetService for textual analysis, refund automation per P3, ban logic for repeated chargebacks.\n        Provide analytics for flag counts + statuses.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Policy P3, F12.9, Section 2 components.",
    "target_files": [],
    "input_files": [],
    "deliverables": "Schema, admin resource, service hooking AI heuristics, doc.",
    "acceptance_criteria": "Flags recorded + thresholded (auto-hide at 3), moderation actions logged, AI heuristics produce review queue suggestions, refund automation documented.",
    "dependencies": [
      "I3.T3",
      "I4.T3",
      "I4.T4"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I4.T9",
    "iteration_id": "I4",
    "iteration_goal": "Deliver classifieds marketplace foundation covering geo data, categories, listings, payments/promotions, moderation, masked communication, and PostGIS/Elasticsearch search so users can post and discover listings within policy bounds.",
    "description": "Deliver end-to-end verification + analytics: Playwright/Cypress tests for listing creation/search/contact, load tests for search radius queries, click tracking instrumentation hooking `/track/click` to listings, dashboards for revenue/promotions/refunds.\n        Update CI + docs accordingly.",
    "agent_type_hint": "QAAgent",
    "inputs": "All I4 tasks, Section 4 quality gate, click tracking spec.",
    "target_files": [],
    "input_files": [],
    "deliverables": "E2E tests, integration tests, docs for analytics dashboards.",
    "acceptance_criteria": "Tests pass covering fees/promotions/search/messaging, coverage metrics updated, analytics doc describes dashboards + KPIs, CI job includes new suites.",
    "dependencies": [],
    "parallelizable": false,
    "done": false
  }
]