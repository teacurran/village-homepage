# Test configuration for BaseIntegrationTest with PostgreSQL 17 + PostGIS Testcontainers
# Ref: Foundation Blueprint Section 3.5 (Testing Strategy)
# Task: I1.T2 - BaseIntegrationTest infrastructure

# CRITICAL: Disable .env file loading to prevent dev database configuration from interfering with tests
quarkus.config.source.env.enabled=false

# Database Configuration - Quarkus Dev Services with Testcontainers PostgreSQL 17
# NOTE: Must explicitly set db-kind to postgresql to override quarkus-test-h2 dependency
quarkus.datasource.db-kind=postgresql
# NOTE: username, password, and jdbc.url are auto-configured by Dev Services (Testcontainers)
quarkus.datasource.jdbc.driver=org.postgresql.Driver

# Enable Dev Services for automatic Testcontainers management
quarkus.datasource.devservices.enabled=true
quarkus.datasource.devservices.image-name=postgis/postgis:17-3.5-alpine
quarkus.datasource.devservices.init-script-path=db/init-test-postgis.sql

# Hibernate ORM Configuration
quarkus.hibernate-orm.database.generation=drop-and-create
quarkus.hibernate-orm.log.sql=true
quarkus.hibernate-orm.sql-load-script=no-file
# Disable database version check to allow H2 emulation mode in legacy tests
# New tests using BaseIntegrationTest will use PostgreSQL Testcontainers
%test.quarkus.hibernate-orm.database.version-check.enabled=false
# CRITICAL: Enable Jackson for JSONB type handling (fixes HashMap serialization to JSONB)
quarkus.hibernate-orm.mapping.jackson.convert-to-json-mode=enabled

# Logging
quarkus.log.level=WARN
quarkus.log.category."villagecompute.homepage".level=INFO
quarkus.log.category."org.testcontainers".level=INFO

# Disable OIDC security for tests
quarkus.oidc.enabled=false
quarkus.security.auth.enabled-in-dev-mode=false
quarkus.security.jpa.enabled=false

# Disable Hibernate Search Elasticsearch for tests
quarkus.hibernate-search-orm.enabled=false

# Disable OpenTelemetry for tests
quarkus.otel.sdk.disabled=true

# Auth configuration for tests
villagecompute.auth.cookie.name=vu_anon_id
villagecompute.auth.cookie.secure=true
villagecompute.auth.cookie.http-only=true
villagecompute.auth.cookie.same-site=Lax
villagecompute.auth.cookie.max-age=31536000
villagecompute.auth.bootstrap.token=test-bootstrap-token
villagecompute.auth.bootstrap.admin-exists=false
villagecompute.auth.jwt.secret=unit-test-signing-secret
villagecompute.auth.jwt.issuer=test-suite
villagecompute.auth.jwt.audience=village-homepage-test
villagecompute.auth.jwt.expiration-minutes=30
villagecompute.auth.rate-limit.bootstrap.max-requests=5
villagecompute.auth.rate-limit.bootstrap.window-seconds=3600
villagecompute.auth.rate-limit.login.max-requests=20
villagecompute.auth.rate-limit.login.window-seconds=60

# Alpha Vantage API (test key)
alphavantage.api-key=test-api-key

# Stripe API keys (test values)
stripe.secret-key=sk_test_dummy_for_tests
stripe.webhook-secret=whsec_test_dummy_for_tests

# Email IMAP configuration (test values)
email.imap.host=localhost
email.imap.port=1143
email.imap.username=test@example.com
email.imap.password=test_placeholder
email.imap.folder=INBOX
email.imap.poll-interval-seconds=60
